#!/usr/bin/env ruby

abort "Usage: sidekiq_bench [queue]" if ARGV.include? "-h"

require "rubygems"
require "redis"

@conn = Redis.new

@queue = ARGV[0] || "default"

def get_length
  @conn.llen "queue:#{@queue}"
end

last_length = get_length

loop do
  sleep 1

  new_length = get_length
  puts last_length - new_length
  last_length = new_length
end
